{% extends "base.html" %}

{% block title %}{{ name }} - Kernel Leaderboards{% endblock %}

{% block content %}
<div class="content-stack">
    <h1 class="font-mono">
        {% set color = name|to_color %}
        <div class="colored-square" style="background-color: {{ color }}"></div>
        {{ name }}
    </h1>
    
    <div>
        <h2>Deadline</h2>
        <p>
            {% if time_left != None %}
                {{ time_left }} ({{ deadline|format_datetime }})
            {% else %}
                {{ deadline|format_datetime }}
            {% endif %}
        </p>
    </div>

    <div>
        <h2>Language</h2>
        <p>{{ lang }}</p>
    </div>

    <div>
        <h2>GPU Type{{ 's' if gpu_types|length > 1 or gpu_types|length == 0}}</h2>
        <p>{{ gpu_types|join(', ') if gpu_types|length > 0 else 'None' }}</p>
    </div>

    <div>
        <h2>Description</h2>
        <p class="whitespace-pre-wrap">{{ description }}</p>
    </div>

    <div class="relative">
        <div class="flex items-center justify-between mb-2">
            <h2>Reference Implementation</h2>
            <button onclick="toggleCode()" class="text-sm text-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-300 rounded">
                <span id="expand-button">Show more ▽</span>
                <span id="collapse-button" class="hidden">Show less △</span>
            </button>
        </div>
        <pre class="code-block transition-all duration-200 border border-gray-200 rounded-md scrollbar-none" style="max-height: 200px; overflow-x: auto; overflow-y: hidden;" id="code-container"><code>{{ reference }}</code></pre>
        <div id="fade-overlay" class="absolute bottom-0 left-0 right-0 h-16 bg-gradient-to-t from-white to-transparent pointer-events-none"></div>
    </div>

    <script src="{{ url_for('static', filename='js/code_toggle.js') }}"></script>

    {# If there are rankings, show rankings table/s. #}
    {% set has_rankings = rankings is defined and rankings|map('length')|list|sum > 0 %}

    {% if has_rankings %}
        <h2>Rankings</h2>

        {% for i in range(gpu_types|length) %}
            {# Only show the table if there are rankings for this GPU type. #}
            {% if rankings[i]|length > 0 %}
                <h3>{{ gpu_types[i] }}</h3>

                <table class="ranking-table">
                    <thead class="ranking-table-header">
                        <tr>
                            <th scope="col" class="ranking-table-header-cell">Rank</th>
                            <th scope="col" class="ranking-table-header-cell">User</th>
                            <th scope="col" class="ranking-table-header-cell">Score</th>
                            <th scope="col" class="ranking-table-header-cell">Submission Time</th>
                            <th scope="col" class="ranking-table-header-cell">File Name</th>
                        </tr>
                    </thead>
                    <tbody class="ranking-table-row">
                        {% for row in rankings[i] %}
                            <tr>
                                <td>{{ row[4]|decorate_rank }}</td>
                                <td>{{ row[1] }}</td>
                                <td>{{ "%.9f"|format(row[3]) }}</td>
                                <td>{{ row[2]|format_datetime }}</td> 
                                <td>{{ row[0] }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% endif %}
        {% endfor %}
    {% endif %}
</div>
{% endblock %} 